<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>RML Analyzer</title>
    <script src="http://code.jquery.com/jquery-1.10.2.js"></script>
    <script src="http://code.jquery.com/ui/1.10.4/jquery-ui.js"></script>
    <link type="stylesheet" href="//code.jquery.com/ui/1.10.4/themes/smoothness/jquery-ui.css">
    <script>

      var rmloutput = [];
      $(function() {
        timerBreak = 0;
        var canvas = $("#canvas")[0];
        var ctx = canvas.getContext( "2d" );
        var px = 0;
        var py = 0;
        var cx = 0;
        var cy = 0;
        var line = 0;
        var timer = 0;
        var curfile = 0;
        var load_rml_timers;
        $("#demo").click(function(){
            runDemo();
        });
        $("#pause").click(function(){
            $.each(load_rml_timers, function(i, timer) {
               if (timer) {
                 clearTimeout(timer);
                }
            });
        });
        $("#resume").click(runDemo);
        function Func(value){
          var split = value.replace(';','').replace('PD','').split(',');
          cx = split[0]; 
          cy = split[1];
          drawLine(cx,cy,px,py,line)
          px = cx;
          py = cy;
          line = line + 1;
        }
        function drawLine(cx,cy,px,py,line){
          ctx.beginPath();
          ctx.moveTo( px/5, py/5);
          ctx.lineTo( cx/5, cy/5);
          ctx.closePath();
          ctx.stroke();
          $("#printline").text("Line: "+line);
        }
        function runDemo(){
            $.get("kono.rml",function(data){
              console.log(typeof(data));
              drawPath(data);
            });
        }
        function drawPath(rml){
          var coord = rml.match(/PD.*?;/g);
          load_rml_timers = coord.map(function(v, i) {
              if (i < curfile) {
                  return null;
              } else {
                  return setTimeout(function() {
                      Func(v);
                  }, 10+i*10);
              }
          });
        }
        
       function readFile (evt) {
           var files = evt.target.files;
           var file = files[0];           
           var reader = new FileReader();
           reader.onload = function() {
             console.log(this.result);            
             drawPath(this.result);
           }
           reader.readAsText(file)
           // data = reader.result;
           // console.log(data); 
        }

        $('#load_file').change(function(e){
            readFile(e);
        });
      });

    </script>
  </head>
  <body>
    <h1>RML Analyzer</h1>

    <div id="read_text">load RML</div>        
    <input type="file" id="load_file" name="files[]" multiple />
    <br />
    <hr />
    <button id="demo">run demo</button>
    <button id="pause">pause</button>
    <button id="resume">resume</button>
    <hr />
    <div id="printline"></div>
    <div id="list"></div>


    <canvas id="canvas" width="1000" height="1000"></canvas>
  </body>
</html>

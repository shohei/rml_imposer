<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>load test</title>
    <script src="http://code.jquery.com/jquery-1.10.2.js"></script>
    <script src="http://code.jquery.com/ui/1.10.4/jquery-ui.js"></script>
    <link type="stylesheet" href="//code.jquery.com/ui/1.10.4/themes/smoothness/jquery-ui.css">
    <script>
      timerBreak = 0;
      $(function() {
        $("#demo").click(function(){
          alert('hoge');
        });

        $("#stop").click(function(){
          if(timer){
            clearTimeout(timer);
            timerBreak = 1;
          }
        });
        $.get("kono.rml",function(data){
          //console.log(data);
          drawPath(data);
        });

        var canvas = $("#canvas")[0];
        var ctx = canvas.getContext( "2d" );
        var px = 0;
        var py = 0;
        var cx = 0;
        var cy = 0;
        var line = 0;
        var timer = 0;
        function Func(value){
          var split = value.replace(';','').replace('PD','').split(',');
          cx = split[0]; 
          cy = split[1];
          drawLine(cx,cy,px,py,line)
          px = cx;
          py = cy;
          line = line + 1;
        }
        function drawLine(cx,cy,px,py,line){
          ctx.beginPath();
          ctx.moveTo( px/5, py/5);
          ctx.lineTo( cx/5, cy/5);
          ctx.closePath();
          ctx.stroke();
          $("#printline").text("Line: "+line);
        }
        function drawPath(rml){
          var coord = rml.match(/PD.*?;/g);
          $.each(coord, function(index, value) {
            timer = setTimeout(function(){
              Func(value);
              // console.log(timer);
              // if(timerBreak==1){
              //   clearTimeout(timer);
              // }
            },10+index*10);
          });
        }
      });

    </script>
  </head>
  <body>
    <h1>RML Analyzer</h1>

    <div id="read_text">load RML</div>        
    <button id="demo">run demo</button>
    <button id="stop">stop</button>
    <div id="printline">hey</div>


    <canvas id="canvas" width="1000" height="1000"></canvas>
  </body>
</html>
